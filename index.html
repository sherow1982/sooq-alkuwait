<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سوق الكويت | Souq Al-Kuwait</title>
    
    <!-- Meta & SEO -->
    <meta name="description" content="أفضل العروض والمنتجات في سوق الكويت. تسوق الآن واحصل على توصيل سريع وضمان ذهبي.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://sooq-alkuwait.arabsad.com/">
    
    <!-- Fonts & Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: { colors: { primary: '#1e3a8a', secondary: '#fbbf24', surface: '#f8fafc' }, fontFamily: { tajawal: ['Tajawal', 'sans-serif'] } }
            }
        }
    </script>
    <style>.hide-scrollbar::-webkit-scrollbar { display: none; }</style>
</head>
<body class="bg-surface font-tajawal text-gray-800 flex flex-col min-h-screen">

    <!-- NoScript Warning -->
    <noscript>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-center">
            تنبيه: يرجى تفعيل JavaScript في المتصفح ليعمل الموقع بشكل صحيح.
        </div>
    </noscript>

    <main class="container mx-auto px-4 py-8 flex-grow">
        
        <!-- Top Banner -->
        <div class="mb-8">
            <img src="https://raw.githubusercontent.com/sherow1982/sooq-alkuwait/main/%D8%B3%D9%88%D9%82%20%D8%A7%D9%84%D9%83%D9%88%D9%8A%D8%AA.webp" 
                 alt="عروض سوق الكويت" 
                 class="w-full h-auto rounded-3xl shadow-lg object-cover hover:shadow-xl transition-shadow duration-300">
        </div>

        <!-- Hero Section (Search) -->
        <header class="bg-primary text-white py-12 relative overflow-hidden rounded-[2rem] shadow-xl text-center mb-10">
            <div class="relative z-10">
                <h1 class="text-3xl md:text-5xl font-bold mb-6">أفضل العروض في الكويت</h1>
                <p class="text-blue-200 mb-8 max-w-lg mx-auto">تسوق بثقة مع ضمان 14 يوم للاسترجاع وتوصيل سريع لباب بيتك.</p>
                
                <!-- Hero Search Bar -->
                <div class="max-w-xl mx-auto relative group px-4">
                    <input type="text" id="search-input" 
                           oninput="if(window.filterProductsBySearch) window.filterProductsBySearch(this.value)" 
                           placeholder="ابحث عن منتج..." 
                           class="w-full py-4 px-6 rounded-full text-gray-800 shadow-xl focus:outline-none focus:ring-4 focus:ring-secondary/50 transition">
                    <i class="fa-solid fa-search absolute left-8 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            <!-- Background Icons Decoration -->
            <div class="absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none">
                <i class="fa-solid fa-bag-shopping absolute top-10 left-10 text-8xl"></i>
                <i class="fa-solid fa-cart-shopping absolute bottom-10 right-10 text-8xl"></i>
            </div>
        </header>

        <!-- Category Filters -->
        <div class="mb-8">
            <h2 class="font-bold text-gray-700 mb-3 px-1 flex items-center gap-2"><i class="fa-solid fa-layer-group text-secondary"></i> تصفح الأقسام</h2>
            <div class="flex gap-3 overflow-x-auto hide-scrollbar pb-2 px-1 w-full" id="category-filters">
                <!-- سيتم تعبئتها بواسطة script.js -->
            </div>
        </div>

        <!-- Products Grid -->
        <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6 min-h-[300px]">
            <div class="col-span-full text-center py-20"><i class="fa-solid fa-circle-notch fa-spin text-primary text-2xl"></i></div>
        </div>
        
        <!-- Load More Button -->
        <div class="text-center mt-12 hidden" id="load-more-container">
            <button onclick="loadMoreProducts()" class="bg-white border-2 border-gray-200 text-gray-700 hover:border-primary hover:text-primary font-bold py-3 px-8 rounded-full shadow-sm transition-all transform hover:scale-105 group">
                عرض المزيد <i class="fa-solid fa-chevron-down mr-2 group-hover:translate-y-1 transition-transform"></i>
            </button>
        </div>
    </main>

    <!-- Scripts -->
    <script src="layout.js"></script> <!-- Header & Footer -->
    <script src="script.js"></script> <!-- Main Logic -->
    
    <script>
        // ==========================================
        //  منطق عرض المنتجات (Rendering Logic)
        // ==========================================
        
        let currentDisplayCount = 12;
        let currentFilteredProducts = [];

        window.renderProducts = function(products) {
            currentFilteredProducts = products;
            const grid = document.getElementById('products-grid');
            const loadMoreBtn = document.getElementById('load-more-container');
            
            // حالة عدم وجود منتجات
            if (!products || products.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <i class="fa-solid fa-magnifying-glass text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 font-bold">عذراً، لا توجد منتجات تطابق بحثك.</p>
                        <button onclick="filterProducts('all'); document.getElementById('search-input').value='';" class="mt-4 text-primary underline text-sm">عرض كل المنتجات</button>
                    </div>`;
                loadMoreBtn.classList.add('hidden');
                return;
            }

            // تحديد العدد المعروض (Pagination)
            const toShow = products.slice(0, currentDisplayCount);
            
            grid.innerHTML = toShow.map(product => {
                // 1. استخراج الأسعار (String -> Float)
                const regularVal = product.pricing?.regular;
                const saleVal = product.pricing?.sale;
                
                const regularPrice = parseFloat(regularVal) || 0;
                const salePrice = parseFloat(saleVal) || 0;

                // 2. منطق الخصم
                const hasDiscount = (salePrice > 0 && salePrice < regularPrice);
                const finalPrice = hasDiscount ? salePrice : regularPrice;

                // 3. تنسيق النصوص
                const displayPriceStr = finalPrice.toFixed(2);
                const oldPriceStr = regularPrice.toFixed(2);
                
                const image = product.media?.main_image || "https://via.placeholder.com/300";
                const title = product.title || "منتج بدون عنوان";
                const category = product.category || "عام";

                return `
                <div class="bg-white rounded-2xl overflow-hidden group border border-gray-100 hover:shadow-xl transition-all duration-300 flex flex-col h-full relative">
                    <!-- صورة المنتج -->
                    <div class="relative aspect-square overflow-hidden bg-gray-50">
                        <a href="product.html?id=${product.id}" class="block w-full h-full">
                            <img src="${image}" alt="${title}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy">
                        </a>
                        
                        <!-- بادج الخصم -->
                        ${hasDiscount ? `<span class="absolute top-3 right-3 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm z-10 animate-pulse">خصم</span>` : ''}
                        
                        <!-- زر الإضافة السريع (يظهر عند التحويم) -->
                        <button onclick="addToCartFromHome('${product.id}')" class="absolute bottom-3 right-3 w-10 h-10 bg-white text-primary rounded-full shadow-lg flex items-center justify-center transform translate-y-14 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 z-20 hover:bg-primary hover:text-white" title="أضف للسلة">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>

                    <!-- تفاصيل المنتج -->
                    <div class="p-4 flex flex-col flex-grow">
                        <div class="text-[10px] text-gray-500 mb-1 font-bold bg-gray-50 w-fit px-2 py-0.5 rounded border border-gray-100">${category}</div>
                        
                        <a href="product.html?id=${product.id}" class="block group-hover:text-primary transition-colors">
                            <h3 class="font-bold text-gray-800 mb-2 line-clamp-2 text-sm leading-relaxed min-h-[2.5rem]" title="${title}">${title}</h3>
                        </a>
                        
                        <div class="mt-auto pt-3 border-t border-gray-50 flex justify-between items-center">
                            <div class="flex flex-col">
                                <span class="text-lg font-extrabold text-primary">${displayPriceStr} <span class="text-xs font-normal">KWD</span></span>
                                ${hasDiscount ? `<span class="text-xs text-gray-400 line-through">${oldPriceStr}</span>` : ''}
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');

            // إظهار/إخفاء زر المزيد
            if (currentDisplayCount >= products.length) loadMoreBtn.classList.add('hidden');
            else loadMoreBtn.classList.remove('hidden');
        };

        // دالة زر "عرض المزيد"
        function loadMoreProducts() { 
            currentDisplayCount += 12; 
            window.renderProducts(currentFilteredProducts); 
        }
    </script>
</body>
</html>
