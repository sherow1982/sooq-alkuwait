// تحديث دالة إعداد الفئات
function setupCategories() {
    const categories = ['all', ...new Set(allProducts.map(p => p.category))];
    const container = document.getElementById('category-filters');
    if (!container) return;
    
    // تفريغ الحاوية
    container.innerHTML = '';

    // دالة مساعدة للأيقونات
    const getIcon = (cat) => {
        if(cat.includes('إلكترونيات') || cat.includes('هاتف')) return 'fa-mobile-screen-button';
        if(cat.includes('منزل') || cat.includes('أثاث')) return 'fa-couch';
        if(cat.includes('ملابس') || cat.includes('موضة')) return 'fa-shirt';
        if(cat.includes('جمال') || cat.includes('عناية')) return 'fa-spray-can-sparkles';
        if(cat.includes('ألعاب')) return 'fa-gamepad';
        if(cat.includes('مطبخ')) return 'fa-kitchen-set';
        if(cat.includes('سيار')) return 'fa-car';
        return 'fa-layer-group';
    };

    categories.forEach(cat => {
        const isAll = cat === 'all';
        const label = isAll ? 'الكل' : cat;
        const iconClass = isAll ? 'fa-border-all' : getIcon(cat);
        
        const btn = document.createElement('button');
        // كلاسات Tailwind للتصميم الجديد (زر كبير مع أيقونة)
        btn.className = `filter-btn group min-w-[100px] flex flex-col items-center gap-3 p-3 rounded-2xl border transition-all duration-300 ${isAll ? 'active bg-white border-primary shadow-md' : 'bg-white border-gray-100 hover:border-gray-300 hover:shadow-sm'}`;
        
        btn.innerHTML = `
            <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg transition-colors ${isAll ? 'bg-primary text-white' : 'bg-gray-50 text-gray-500 group-hover:bg-blue-50 group-hover:text-primary'}">
                <i class="fa-solid ${iconClass}"></i>
            </div>
            <span class="font-bold text-xs text-center ${isAll ? 'text-primary' : 'text-gray-600 group-hover:text-gray-900'}">${label}</span>
        `;
        
        btn.onclick = () => filterByCategory(cat);
        container.appendChild(btn);
    });
}

// تحديث دالة filterByCategory لتتوافق مع الستايل الجديد
function filterByCategory(category) {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        const btnLabel = btn.querySelector('span').textContent;
        const isSelected = btnLabel === category || (category === 'all' && btnLabel === 'الكل');
        const iconDiv = btn.querySelector('div');
        const labelSpan = btn.querySelector('span');

        if (isSelected) {
            btn.classList.add('active', 'border-primary', 'shadow-md');
            btn.classList.remove('border-gray-100');
            
            iconDiv.classList.add('bg-primary', 'text-white');
            iconDiv.classList.remove('bg-gray-50', 'text-gray-500', 'group-hover:bg-blue-50', 'group-hover:text-primary');
            
            labelSpan.classList.add('text-primary');
            labelSpan.classList.remove('text-gray-600');
        } else {
            btn.classList.remove('active', 'border-primary', 'shadow-md');
            btn.classList.add('border-gray-100');
            
            iconDiv.classList.remove('bg-primary', 'text-white');
            iconDiv.classList.add('bg-gray-50', 'text-gray-500', 'group-hover:bg-blue-50', 'group-hover:text-primary');
            
            labelSpan.classList.remove('text-primary');
            labelSpan.classList.add('text-gray-600');
        }
    });

    if (category === 'all') {
        renderProducts(allProducts);
    } else {
        const filtered = allProducts.filter(p => p.category === category);
        renderProducts(filtered);
    }
}
